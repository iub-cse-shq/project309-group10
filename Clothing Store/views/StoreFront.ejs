<%- include('partials/header.ejs') %>
        <title>Online Marketplace</title>
        <link rel="stylesheet" href="css/StoreFront.css" />
    </head>

    <body>
        <header class="header">
            <ul>
                <li id="om">Online Marketplace</li>
                <li id="c0"><a class="c1" href="/cart">Cart</a>(</li>
                <P id=cartCounter>0</P>
                <P id="c2">)</P>
                <li id="c3"><a href="/newProduct">New Product</a></li>

            </ul>
        </header>

        <div id="mainDiv">
            <% if(products.length>0) { %>
                <% products.forEach(product=> { %>
                    <div id="divStoreItem">
                        <a class="storeName" href='/productDetail/<%=product._id%>'>
                            <%= product.name %>
                        </a>
                        <img id="storeImage" src="<%=product.url%>" />
                        <span id="storeCartPrice ">Taka:<%= product.price %></span>
                        <button class="buttonCart">Cart</button>
                    </div>
                    <% }) %>
                        <% } else { %>
                            <p id="storeFrontStatus">No product available.</p>
                            <% } %>
        </div>
    <%let martProductInEJS=JSON.stringify(products)%>
    

        <script src="js/jquery-3.5.1.min.js"></script>
        <script>
            martProduct = [];
try {
    martProduct=JSON.parse(`<%-martProductInEJS%>`);
}
catch(err) {
   alert('Error in parsing')
}
           
            var cartProduct = [];
            if (window.localStorage.getItem('cartProduct')) {
                cartProduct = JSON.parse(window.localStorage.getItem('cartProduct'));
            }
            $('#cartCounter').text(cartProduct.length);
            //------------------------------------------------------------------------------------------------------------------------------               
            $('.buttonCart').click(function (event) {
            
                let cartItemName;
                if (cartProduct.length == 0) {
                    let buttonClicked = $(this).parent().children();
                    let cartItemName = buttonClicked[0].innerText;
                    addToCart(cartItemName);
                }
                else {
                    let buttonClicked = $(this).parent().children();
                    cartItemName = buttonClicked[0].innerText;
                    for (var i = 0; i < cartProduct.length; i++) {
                        if (cartProduct[i].name == cartItemName) {
                            alert('This item ' + cartItemName + ' is already added to the cart');
                            return;
                        }
                    }
                    addToCart(cartItemName);
                }
            });
            //-----------------------------------------------------------------------------------------------------------------------------
            function addToCart(cartItemName) {
                let x = 0;
                for (let i = 0; i < martProduct.length; i++) {
                    if (martProduct[i].name == cartItemName) {
                        x = i;
                    }
                }
                
                let cartItemPic = martProduct[x].url;
                let cartItemPrice = martProduct[x].price;
                let cartItemQuantity = martProduct[x].quantity;
                let cartItemDescription = martProduct[x].description;
                let newCartProduct = { name: cartItemName, description: cartItemDescription, url: cartItemPic, quantity: cartItemQuantity, price: cartItemPrice };
                cartProduct.push(newCartProduct);
                window.localStorage.setItem('cartProduct', JSON.stringify(cartProduct));
                alert('Item ' + cartItemName + ' is added to the cart');
                $('#cartCounter').text(cartProduct.length);
            }


        </script>

<%- include('partials/footer.ejs') %>  